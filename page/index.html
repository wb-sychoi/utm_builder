<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTM BUILDER</title>
    <style>
        #create_campaign_name,
        #create_ad_group_name,
        #create_ad_name {
            margin: 10px;
            padding: 10px;
            border: 2px solid black;
            width: 1200px;
        }
    </style>
</head>

<body>
    <a href="/">HOME</a>
    <h1>BUILDER</h1>

    <div id="create_campaign_name">

        <h3>캠페인명 생성하기</h3>
        <label for="campaign_name_number">순번: <input type="text" id="campaign_name_number" placeholder="00"></label>
        <label for="campaign_name_title">도메인: <input type="text" id="campaign_name_title"
                placeholder="{아이템}_{아이템}_..."></label>
        <label for="campaign_name_code">코드: <input type="text" id="campaign_name_code" placeholder="AA"></label>

        <button onclick="campaignOutput()">생성</button>

        <h3>캠페인명 결과:</h3>
        <pre id="campaign_name_result">(여기에 출력됩니다)</pre>
    </div>

    <div id="create_ad_group_name">
        <h3>광고그룹명 생성하기</h3>
        <label for="ad_group_name_number">순번: <input type="text" id="ad_group_name_number" placeholder="00"></label>
        <label for="ad_group_name_code">캠페인 코드 추출: 캠페인명에 생성된 결과를 붙여넣으세요.<input type="text" id="ad_group_name_code"
                placeholder="예: 00.브랜드-AA"></label>
        <!-- <button onclick="extractSuffix()">추출</button> -->

        <!-- <h3>추출 결과:</h3> -->
        <!-- <pre id="ad_group_name_code_result">(여기에 캠페인 CODE가 출력됩니다)</pre> -->

        <label for="ad_group_name_title">서브도메인: <input type="text" id="ad_group_name_title"
                placeholder="{아이템}_{아이템}_..."></label><br><br>

        <label for="ad_group_name_type">핵심목표 선택:
            <select id="ad_group_name_type">
                <option value="">-- 필수선택 --</option>
                <option value="BR">브랜딩</option>
                <option value="CV">전환</option>
                <option value="LD">리드</option>
                <option value="TR">트래픽</option>
                <option value="EG">참여</option>
                <option value="RT">리타게팅</option>
                <option value="PM">프로모션</option>
                <option value="MX">혼합</option>
            </select>
        </label>

        <label for="ad_group_name_time">운영방식 선택:
            <select id="ad_group_name_time">
                <option value="">-- 필수선택 --</option>
                <option value="A">상시</option>
                <option value="T">일시</option>
                <option value="R">정기</option>
            </select>
        </label>

        <label for="ad_group_name_device">디바이스 선택:
            <select id="ad_group_name_device">
                <option value="">-- 필수선택 --</option>
                <option value="A">전체</option>
                <option value="M">모바일</option>
                <option value="P">데스크톱</option>
                <option value="T">테블릿</option>
                <option value="V">영상기기(TV)</option>
            </select>
        </label>

        <label for="ad_group_name_platform">매체/유형 선택:
            <select id="ad_group_name_platform">
                <option value="">-- 필수선택 --</option>
                <option value="NSPW">네이버 파워링크</option>
                <option value="NSSP">네이버 쇼핑검색</option>
                <option value="NSBR">네이버 브랜드검색</option>
                <option value="NSPC">네이버 파워콘텐츠</option>
                <option value="NSPL">네이버 플레이스</option>
                <option value="GGSA">구글 검색</option>
                <option value="GGDA">구글 디스플레이</option>
                <option value="GGDG">구글 디멘드젠</option>
                <option value="GGVA">구글 동영상</option>
                <option value="GGPX">구글 PMAX</option>
                <option value="MTAR">메타 인지도</option>
                <option value="MTTR">메타 트래픽</option>
                <option value="MTEG">메타 참여</option>
                <option value="MTLD">메타 리드(잠재고객)</option>
                <option value="MTAP">메타 앱 홍보</option>
                <option value="MTSL">메타 판매</option>
                <!-- <option value="MBRS">모비온 쇼핑</option>
                <option value="MBDB">모비온 DB전환</option>
                <option value="MBTR">모비온 유입</option>
                <option value="MBBR">모비온 브랜딩</option>
                <option value="MBPC">모비온 가망고객</option> -->
                <option value="CTCA">크리테오 신규고객</option>
                <option value="CTRT">크리테오 리타겟팅</option>
            </select>
        </label>

        <button onclick="adGroupOutput()">생성</button>

        <h3>광고그룹명 결과:</h3>
        <pre id="ad_group_name_result">(여기에 출력됩니다)</pre>
    </div>

    <div id="create_ad_name">
        <h3>광고명 생성하기</h3>

        <label for="ad_name_title">서브도메인: <input type="text" id="ad_name_title"
                placeholder="{주제1}_{주제1.1}_{주제1.1.1}"></label>

        <label for="ad_name_ab_test">A/B테스트:
            <input type="text" id="ad_name_ab_test" placeholder="A or B"></label>
        </label>

        <label for="ad_name_version">버전:
            <input type="text" id="ad_name_version" placeholder="00"></label><br><br>
        </label>

        <label for="ad_name_deliberate">심의정보 선택:
            <select id="ad_name_deliberate">
                <option value="">-- 필수선택 --</option>
                <option value="O">일반</option>
                <option value="Y">심의완료</option>
                <option value="N">비심의</option>
            </select>
        </label>

        <label for="ad_name_type">소재유형 선택:
            <select id="ad_name_type">
                <option value="">-- 필수선택 --</option>
                <option value="I">이미지</option>
                <option value="V">영상</option>
                <option value="M">복합</option>
            </select>
        </label>

        <label for="ad_name_date">
            날짜 선택:
            <input type="date" id="ad_name_date">
        </label>
        <span id="ad_name_date_result"></span>



        <button onclick="adOutput()">생성</button>

        <h3>광고명 결과:</h3>
        <pre id="ad_name_result">(여기에 출력됩니다)</pre>
    </div>

    <div id="create_utm_url">
        <!-- 버튼 -->
        <button onclick="createUtmUrl()">UTM 생성</button>
        <!-- UTM 결과 보여주는 곳 -->
        <pre id="utm_url_result">(여기에 UTM URL이 생성됩니다)</pre>

    </div>

    <script>
        const _UTMMAPPING = {
            NSPW: {
                utm_source: "naver",
                utm_medium: "cpc",
                utm_content: "{query}",
                utm_term: "{keyword}",
                utm_id: "{ad}"
            },
            NSBR: {
                utm_source: "naver",
                utm_medium: "cpc",
                utm_content: "{query}-클릭위치(enum)",
                utm_term: "{keyword}",
                utm_id: "{ad}"
            },
            GGSA: {
                utm_source: "google",
                utm_medium: "cpc",
                utm_term: "{keyword}",
                utm_id: "{creative}"
            },
            GGDA: {
                utm_source: "google",
                utm_medium: "display",
                utm_id: "{creative}"
            },
            GGVA: {
                utm_source: "google",
                utm_medium: "paid_video",
                utm_id: "{creative}"
            },
            GGDG: {
                utm_source: "google",
                utm_medium: "cpc",
                utm_id: "{creative}"
            },
            GGPX: {
                utm_source: "google",
                utm_medium: "cpc",
                utm_id: "에셋그룹ID - 수동입력"
            },
            MTAR: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            MTTR: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            MTEG: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            MTLD: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            MTAP: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            MTSL: {
                utm_source: "{{site_source_name}}}",
                utm_medium: "paid_social",
                utm_campaign: "{{adset.name}}",
                utm_content: "{{ad.name}}-{{placement}}",
                utm_id: "{{ad.id}}"
            },
            CTCA: {
                utm_source: "criteo",
                utm_medium: "display",
                utm_id: "{{adid}}"
            },
            CTRT: {
                utm_source: "criteo",
                utm_medium: "display",
                utm_id: "{{adid}}"
            },
        }


        function campaignOutput() {
            const campaignNameNumber = document.getElementById("campaign_name_number").value;
            const campaignNameTitle = document.getElementById("campaign_name_title").value;
            const campaignNameCode = document.getElementById("campaign_name_code").value;

            const output = `${campaignNameNumber}.${campaignNameTitle}-${campaignNameCode}`;
            document.getElementById("campaign_name_result").textContent = output;
        }

        function adGroupOutput() {
            const adGroupNameNumber = document.getElementById("ad_group_name_number").value;
            const adGroupNameCode = document.getElementById("ad_group_name_code").value;
            const adGroupNameCodeSplit = adGroupNameCode.split("-");
            const adGroupNameCodeResult = adGroupNameCodeSplit[adGroupNameCodeSplit.length - 1]
            const adGroupNameTitle = document.getElementById("ad_group_name_title").value;
            const adGroupNameType = document.getElementById("ad_group_name_type").value;
            const adGroupNameTime = document.getElementById("ad_group_name_time").value;
            const adGroupNameDevice = document.getElementById("ad_group_name_device").value;
            const adGroupNamePlatform = document.getElementById("ad_group_name_platform").value;

            const output = `${adGroupNameNumber}.${adGroupNameCodeResult}-${adGroupNameTitle}-${adGroupNameType}-${adGroupNameTime}-${adGroupNameDevice}-${adGroupNamePlatform}`;
            document.getElementById("ad_group_name_result").textContent = output;
        }

        document.getElementById("ad_name_date").addEventListener("change", function () {
            const date = new Date(this.value);
            if (!isNaN(date)) {
                const yy = String(date.getFullYear()).slice(2);
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                const result = `${yy}${mm}${dd}`;
                document.getElementById("ad_name_date_result").textContent = result;
            } else {
                document.getElementById("ad_name_date_result").textContent = '';
            }
        });

        function adOutput() {
            const adNameTitle = document.getElementById("ad_name_title").value;
            const adNameAbTest = document.getElementById("ad_name_ab_test").value;
            const adNameVersion = document.getElementById("ad_name_version").value;
            const adNameDeliberate = document.getElementById("ad_name_deliberate").value;
            const adNameType = document.getElementById("ad_name_type").value;
            const adNameDateResult = document.getElementById("ad_name_date_result").textContent;

            const output = `${adNameTitle}-${adNameVersion}-${adNameDeliberate}-${adNameType}-${adNameDateResult}`;
            document.getElementById("ad_name_result").textContent = output;
        }

        function createUtmUrl() {
            const select = document.getElementById("ad_group_name_platform").value;
            const resultBox = document.getElementById("utm_url_result");
            const adGroupName = document.getElementById("ad_group_name_result").textContent.trim();
            const adName = document.getElementById("ad_name_result").textContent.trim();

            if (!select) {
                alert("매체/유형을 선택하세요!");
                return;
            }
            if (!adGroupName || adGroupName === "(여기에 출력됩니다)") {
                alert("광고그룹명을 먼저 생성하세요!");
                return;
            }
            if (!adName || adName === "(여기에 출력됩니다)") {
                // adName이 비정상일 때 utm_content를 아예 넣지 않기 위해
                // 아래에서 처리
            }

            if (_UTMMAPPING[select]) {
                const utm = _UTMMAPPING[select];
                const params = [];

                // utm_source, utm_medium, utm_term, utm_id는 있으면 그대로 사용
                if (utm.utm_source) params.push(`utm_source=${utm.utm_source}`);
                if (utm.utm_medium) params.push(`utm_medium=${utm.utm_medium}`);


                // utm_campaign: _UTMMAPPING에 있으면 그 값, 없으면 adGroupName
                let utm_campaign = utm.utm_campaign !== undefined ? utm.utm_campaign : adGroupName;
                if (utm_campaign) params.push(`utm_campaign=${utm_campaign}`);

                // utm_content: _UTMMAPPING에 있으면 그 값, 없으면 adName
                // 단, adName이 "(여기에 출력됩니다)"면 utm_content 자체를 넣지 않음
                let utm_content;
                if (utm.hasOwnProperty('utm_content')) {
                    utm_content = utm.utm_content;
                } else {
                    utm_content = adName;
                }
                if (
                    utm_content !== undefined &&
                    utm_content !== null &&
                    utm_content !== "" &&
                    utm_content !== "(여기에 출력됩니다)"
                ) {
                    params.push(`utm_content=${utm_content}`);
                }

                if (utm.utm_term) params.push(`utm_term=${utm.utm_term}`);
                if (utm.utm_id) params.push(`utm_id=${utm.utm_id}`);

                // 결과 출력
                const url = params.join("&");
                resultBox.textContent = url;
            } else {
                resultBox.textContent = "유효한 매체 유형이 아닙니다.";
            }
        }

        // function createUtmUrl() {

        //     const select = document.getElementById("ad_group_name_platform").value;
        //     const resultBox = document.getElementById("utm_url_result");
        //     const adGroupName = document.getElementById("ad_group_name_result").textContent.trim();
        //     const adName = document.getElementById("ad_name_result").textContent.trim();

        //     const keepTemplateCampaign = ["MTAR", "MTTR", "MTEG", "MTLD", "MTAP", "MTSL"];

        //     if (_UTMMAPPING[select]) {
        //         const utm = _UTMMAPPING[select];

        //         const params = [];


        //         const utm_campaign = keepTemplateCampaign.includes(select)
        //             ? (utm.utm_campaign || "")
        //             : (adGroupName || utm.utm_campaign || "");

        //         // 핵심 수정: utm_content가 정의 안 돼 있으면 adName 사용
        //         // let utm_content = "";
        //         // if (keepTemplateCampaign.includes(select)) {
        //         //     utm_content = utm.utm_content || "";
        //         // } else {
        //         //     utm_content = adName !== "" ? adName : "";
        //         // }

        //         const utm_content = keepTemplateCampaign.includes(select)
        //             ? (utm.utm_content || "")
        //             : (adName || utm.utm_content || "");


        //         console.log(utm_content.trim())
        //         console.log(utm_content.includes() !== "(여기에 출력됩니다)")


        //         if (utm.utm_source) params.push(`utm_source=${utm.utm_source}`);
        //         if (utm.utm_medium) params.push(`utm_medium=${utm.utm_medium}`);
        //         if (utm_campaign) params.push(`utm_campaign=${utm_campaign}`);
        //         if (utm_content.trim() !== "(여기에 출력됩니다)") params.push(`utm_content=${utm_content}`);
        //         if (utm.utm_term) params.push(`utm_term=${utm.utm_term}`);
        //         if (utm.utm_id) params.push(`utm_id=${utm.utm_id}`);

        //         const url = params.join("&");
        //         resultBox.textContent = url;

        //         console.log("선택된 매체:", select);
        //         console.log("ad_name_result:", adName);
        //         console.log("utm_content 최종값:", utm_content);
        //         console.log("params 최종:", params);
        //     } else {
        //         resultBox.textContent = "유효한 매체 유형이 아닙니다.";
        //     }




        //     // const select = document.getElementById("ad_group_name_platform").value;
        //     // console.log(select)
        //     // const resultBox = document.getElementById("utm_url_result");

        //     // // 광고그룹명 값 가져오기
        //     // // const adGroupName = document.getElementById("ad_group_name_result").textContent.trim();

        //     // const adGroupNameRaw = document.getElementById("ad_group_name_result").textContent.trim();
        //     // const adGroupName = adGroupNameRaw && adGroupNameRaw !== "(여기에 출력됩니다)" ? adGroupNameRaw : "";

        //     // const adNameRaw = document.getElementById("ad_name_result").textContent.trim();
        //     // const adName = adNameRaw && adNameRaw !== "(여기에 출력됩니다)" ? adNameRaw : "";



        //     // if (_UTMMAPPING.hasOwnProperty(select)) {
        //     //     const utm = _UTMMAPPING[select];

        //     //     // 광고그룹명이 있으면 사용, 없으면 매핑된 기본 utm_campaign
        //     //     const utm_campaign = adGroupName !== "" ? adGroupName : (utm.utm_campaign || "");
        //     //     const utm_content = adName !== "" ? adName : (utm.utm_content || "");

        //     //     const url = `utm_source=${utm.utm_source}&utm_medium=${utm.utm_medium}&utm_campaign=${utm_campaign}&utm_content=${utm_content}&utm_term=${utm.utm_term}&utm_id=${utm.utm_id}`;

        //     //     resultBox.textContent = url;
        //     // } else {
        //     //     resultBox.textContent = "유효한 매체 유형이 아닙니다.";
        //     // }

        // }


    </script>
</body>

</html>